
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laudo Técnico Contábil - Análise de DIFAL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: A single-page report structure was designed for clarity and professionalism. It starts with a summary (Resumo) featuring key metrics and a visual chart for a quick overview. It then separates the core issues into a dedicated "Anomalias" section for focused problem-solving. Finally, a "Dados Completos" section provides a searchable, detailed table for granular analysis. This tab-based navigation (Resumo, Anomalias, Dados) was chosen to guide the user from a high-level understanding to specific details logically, making the complex tax information digestible for the client. -->
    <!-- Visualization & Content Choices: 
        - Report Info: Total DIFAL, total value of operations, count of CT-es. Goal: Inform. Viz/Method: Key metric cards. Interaction: Static display. Justification: Provides an immediate summary of the financial impact. Library: Tailwind CSS.
        - Report Info: DIFAL value distribution among recipients. Goal: Compare. Viz/Method: Bar Chart. Interaction: Tooltips on hover. Justification: Visually highlights the most significant recipients in terms of tax amount, allowing for easy comparison. Library: Chart.js.
        - Report Info: Specific CT-es with cadastro errors (wrong taxpayer status, wrong company name). Goal: Organize/Inform. Viz/Method: Styled lists within cards. Interaction: Static display. Justification: Clearly isolates and explains the errors that require the client's direct action. Library: Tailwind CSS.
        - Report Info: Complete list of all CT-es. Goal: Organize/Explore. Viz/Method: Interactive HTML table. Interaction: Search/filter. Justification: Allows the client to look up any specific CT-e for verification, providing full transparency. Library: Vanilla JS for filtering.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f7f4;
            color: #3a3a3a;
        }
        .tab-active {
            border-bottom-color: #4a5568;
            color: #2d3748;
            font-weight: 600;
        }
        .tab {
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }
        .card {
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 1.5rem;
            transition: transform 0.2s ease-in-out;
        }
        .card:hover {
            transform: translateY(-4px);
        }
        .table-anomaly {
            background-color: #fffbeb;
        }
        .table-anomaly td:first-child {
            border-left: 3px solid #fBBF24;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 45vh;
            max-height: 450px;
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        
        <header class="mb-8 p-6 rounded-lg bg-white shadow-sm">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center">
                <div>
                    <h1 class="text-2xl font-bold text-gray-800">Laudo Técnico Contábil</h1>
                    <p class="text-md text-gray-600">Análise de DIFAL em Prestações de Serviço de Transporte</p>
                </div>
                <div class="text-left sm:text-right mt-4 sm:mt-0">
                    <p class="font-semibold text-gray-700">LANDRICO MINAS LTDA</p>
                    <p class="text-sm text-gray-500">CNPJ Matriz (MG): 07.876.409/0001-15</p>
                    <p class="text-sm text-gray-500">CNPJ Filial (SP): 07.876.409/0002-04</p>
                    <p class="text-sm text-gray-500 mt-2">Data do Laudo: 05 de Setembro de 2025</p>
                </div>
            </div>
        </header>

        <main>
            <nav class="flex border-b border-gray-300 mb-6">
                <button class="tab tab-active py-2 px-4" data-target="resumo">Resumo e Análise</button>
                <button class="tab py-2 px-4" data-target="anomalias">Anomalias Identificadas</button>
                <button class="tab py-2 px-4" data-target="dados">Dados Completos</button>
            </nav>

            <div id="resumo" class="content-section">
                <div class="card mb-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-3">1. Objetivo do Laudo</h2>
                    <p class="text-gray-700 leading-relaxed">
                        O presente laudo tem como objetivo analisar as operações de transporte de cargas iniciadas na filial de São Paulo (SP) e destinadas a tomadores localizados em Minas Gerais (MG), que foram classificados como não contribuintes do ICMS. A análise foca na apuração do Diferencial de Alíquota (DIFAL) devido ao estado de destino (MG) e na identificação de anomalias cadastrais nos Conhecimentos de Transporte Eletrônico (CT-e) emitidos no período de Agosto de 2025.
                    </p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="card text-center">
                        <h3 class="text-lg font-semibold text-gray-600">Total de DIFAL Apurado</h3>
                        <p id="totalDifal" class="text-3xl font-bold text-blue-600 mt-2">R$ 0,00</p>
                    </div>
                    <div class="card text-center">
                        <h3 class="text-lg font-semibold text-gray-600">Valor Total dos Fretes</h3>
                        <p id="totalFrete" class="text-3xl font-bold text-gray-800 mt-2">R$ 0,00</p>
                    </div>
                    <div class="card text-center">
                        <h3 class="text-lg font-semibold text-gray-600">CT-es Analisados</h3>
                        <p id="totalCte" class="text-3xl font-bold text-gray-800 mt-2">0</p>
                    </div>
                </div>

                <div class="card mb-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-3">2. Fundamentação: O que é o DIFAL?</h2>
                    <p class="text-gray-700 leading-relaxed mb-4">
                        O Diferencial de Alíquota (DIFAL) foi instituído pela Emenda Constitucional 87/2015 para equilibrar a arrecadação do ICMS entre os estados em operações interestaduais destinadas a um consumidor final não contribuinte do imposto.
                    </p>
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <h4 class="font-semibold text-gray-700">Aplicação neste caso:</h4>
                        <p class="text-gray-600 mt-2">
                            Quando a sua filial de <strong>SP (origem)</strong> realiza um frete para um tomador (cliente) em <strong>MG (destino)</strong> que é <strong>não contribuinte do ICMS</strong>, o imposto sobre a operação é partilhado. A alíquota interna de MG (18%) é maior que a alíquota interestadual de SP para MG (12%). Essa diferença de 6%, o DIFAL, deve ser recolhida para o estado de Minas Gerais. O cálculo garante que a carga tributária da operação seja equivalente à que ocorreria se a compra fosse feita inteiramente dentro de MG.
                        </p>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">DIFAL por Tomador (Top 10)</h2>
                    <div class="chart-container">
                        <canvas id="difalChart"></canvas>
                    </div>
                </div>
            </div>

            <div id="anomalias" class="content-section hidden">
                <div class="card mb-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-3">3. Anomalias Identificadas</h2>
                    <p class="text-gray-700 leading-relaxed">
                        Durante a análise dos CT-es, foram identificadas inconsistências no cadastro de clientes que resultaram em emissões incorretas. Estas anomalias precisam ser corrigidas para evitar futuras autuações e garantir a conformidade fiscal.
                    </p>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="card border-l-4 border-red-500">
                        <h3 class="text-lg font-semibold text-red-700 mb-3">Anomalia 1: Contribuinte de ICMS classificado como "Não Contribuinte"</h3>
                        <p class="text-gray-600 mb-4">
                            Os seguintes clientes <strong>possuem Inscrição Estadual (IE)</strong> e são, portanto, contribuintes do ICMS. No entanto, os CT-es foram emitidos com a indicação de "não contribuinte". Embora o DIFAL tenha sido apurado para regularizar a operação, é crucial que o cadastro seja corrigido para que as próximas emissões sejam feitas corretamente, com o destaque do ICMS na própria operação.
                        </p>
                        <ul id="contribuintes-list" class="list-disc list-inside text-gray-700 space-y-1">
                        </ul>
                    </div>

                    <div class="card border-l-4 border-orange-500">
                        <h3 class="text-lg font-semibold text-orange-700 mb-3">Anomalia 2: Razão social preenchida com dados incorretos</h3>
                        <p class="text-gray-600 mb-4">
                           Foram identificados clientes cuja razão social no CT-e não corresponde ao cadastro correto. Esta divergência pode invalidar o documento fiscal e gerar problemas com a fiscalização.
                        </p>
                        <ul id="razao-social-list" class="list-disc list-inside text-gray-700 space-y-2">
                        </ul>
                    </div>
                </div>

                <div class="card mt-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-3">4. Recomendações</h2>
                     <p class="text-gray-700 leading-relaxed mb-4">
                        Para mitigar a recorrência destes erros e assegurar a conformidade fiscal da empresa, recomendamos as seguintes ações imediatas:
                    </p>
                    <ul class="list-decimal list-inside space-y-3 text-gray-700">
                        <li><strong>Revisão Completa do Cadastro de Clientes:</strong> Realizar uma auditoria no cadastro de todos os clientes, verificando CNPJ, Inscrição Estadual e Razão Social em fontes oficiais (como SINTEGRA ou o site da Receita Federal).</li>
                        <li><strong>Ajuste do Processo de Cadastro:</strong> Implementar um procedimento padrão para o cadastro de novos clientes que inclua a consulta obrigatória da Inscrição Estadual para determinar se o cliente é ou não contribuinte do ICMS, além da validação da razão social.</li>
                        <li><strong>Treinamento da Equipe:</strong> Capacitar a equipe responsável pela emissão de CT-es sobre a importância do preenchimento correto dos dados do tomador e as implicações fiscais de uma classificação incorreta.</li>
                    </ul>
                </div>
            </div>

            <div id="dados" class="content-section hidden">
                 <div class="card">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Detalhes dos CT-es Emitidos</h2>
                    <div class="mb-4">
                        <input type="text" id="searchInput" placeholder="Buscar por tomador, CNPJ ou número do CT-e..." class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nº CT-e</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tomador</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">CNPJ/CPF</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Valor do Frete</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Valor DIFAL (6%)</th>
                                </tr>
                            </thead>
                            <tbody id="cteTableBody" class="bg-white divide-y divide-gray-200">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const cteData = [
            {data: "01/08/2025", numero: "213181", tomador: "TXR DISTRIBUIDORA", cnpj: "41663160000106", ie: "0040281930074", valor: 1668.78},
            {data: "01/08/2025", numero: "213199", tomador: "QUIK DIST DE ARMARINHOS LTDA", cnpj: "08202176000138", ie: "0010172570069", valor: 235.07},
            {data: "01/08/2025", numero: "213268", tomador: "ARTE BRILHO MULTISERVICOS LTDA", cnpj: "07655416000197", ie: "", valor: 243.12},
            {data: "01/08/2025", numero: "213278", tomador: "BRENDA REPRESENTACOES LTDA", cnpj: "10478747000294", ie: "", valor: 10.00},
            {data: "01/08/2025", numero: "213284", tomador: "CICERO PINHEIRO MARTINS", cnpj: "73263095668", ie: "ISENTO", valor: 260.00},
            {data: "04/08/2025", numero: "213298", tomador: "BRENDA REPRESENTACOES LTDA ME", cnpj: "10478747000103", ie: "ISENTO", valor: 10.00},
            {data: "05/08/2025", numero: "213365", tomador: "BRENDA REPRESENTACOES LTDA", cnpj: "10478747000294", ie: "", valor: 10.00},
            {data: "06/08/2025", numero: "213486", tomador: "MINAS MIDIAS COME IMP DE SU", cnpj: "22030322000116", ie: "0025232210084", valor: 130.68},
            {data: "06/08/2025", numero: "213530", tomador: "BRENDA REPRESENTACOES LTDA", cnpj: "10478747000294", ie: "", valor: 10.00},
            {data: "06/08/2025", numero: "213540", tomador: "ERICA CRISTINA MIRSON DE OLIVEIRA", cnpj: "07492902697", ie: "", valor: 130.68},
            {data: "07/08/2025", numero: "213583", tomador: "DEMAE CULINARIA JAPONESA LIDA", cnpj: "27503639000146", ie: "0029470570049", valor: 190.56},
            {data: "07/08/2025", numero: "213587", tomador: "BRENDA REPRESENTACOES LTDA", cnpj: "10478747000294", ie: "", valor: 10.00},
            {data: "07/08/2025", numero: "213613", tomador: "GUGUS EXPRESS MOTOBOY LTDA", cnpj: "37287142000191", ie: "", valor: 359.78},
            {data: "07/08/2025", numero: "213617", tomador: "ALAN SOUSA SILVA", cnpj: "07368973642", ie: "", valor: 130.68},
            {data: "07/08/2025", numero: "213624", tomador: "NIBER GOMES E SILVA", cnpj: "43698818000132", ie: "", valor: 130.68},
            {data: "08/08/2025", numero: "213639", tomador: "CASA E LAZER UTILIDADES REPRESENTACOES L", cnpj: "50357485000143", ie: "", valor: 10.00},
            {data: "08/08/2025", numero: "213664", tomador: "TXR DISTRIBUIDORA", cnpj: "41663160000106", ie: "0040281930074", valor: 1044.02},
            {data: "08/08/2025", numero: "213680", tomador: "BRENDA REPRESENTACOES LTDA", cnpj: "10478747000294", ie: "", valor: 10.00},
            {data: "08/08/2025", numero: "213684", tomador: "BRENDA REPRESENTACOES LTDA", cnpj: "10478747000294", ie: "", valor: 10.00},
            {data: "08/08/2025", numero: "213707", tomador: "EMMERSON MARTINS DE ALMEIDA 54", cnpj: "54516595672", ie: "", valor: 188.18},
            {data: "08/08/2025", numero: "213718", tomador: "EMMERSON MARTINS DE ALMEIDA 54", cnpj: "54516595672", ie: "", valor: 194.06},
            {data: "11/08/2025", numero: "213762", tomador: "BRENDA REPRESENTACOES LTDA ME", cnpj: "10478747000103", ie: "ISENTO", valor: 10.00},
            {data: "11/08/2025", numero: "213782", tomador: "BRENDA REPRESENTACOES LTDA", cnpj: "10478747000294", ie: "", valor: 10.00},
            {data: "11/08/2025", numero: "213791", tomador: "CICERO PINHEIRO MARTINS", cnpj: "73263095668", ie: "ISENTO", valor: 260.00},
            {data: "11/08/2025", numero: "213798", tomador: "RODRIGO ALVES DA SILVA 12104567610", cnpj: "47097906000130", ie: "0043869660023", valor: 128.05},
            {data: "12/08/2025", numero: "213841", tomador: "CHRISTIAN NORBERTO LAGE DE OLIVEIRA", cnpj: "68854277649", ie: "", valor: 10.00},
            {data: "12/08/2025", numero: "213847", tomador: "4568-CIBELE PEREIRA DE OLIVEIRA", cnpj: "04689989699", ie: "", valor: 235.22},
            {data: "12/08/2025", numero: "213910", tomador: "MARIA APARECIDA MAGALHAES ME", cnpj: "13968390000130", ie: "", valor: 10.00},
            {data: "12/08/2025", numero: "213921", tomador: "ATELIE MARCA DAGUA LTDA", cnpj: "10942077000134", ie: "", valor: 130.68},
            {data: "13/08/2025", numero: "213983", tomador: "MIRANDA FREITAS REPRESENTACOES LTDA", cnpj: "03592528000195", ie: "", valor: 10.00},
            {data: "13/08/2025", numero: "214004", tomador: "SENETO COMERCIO ATACADISTA E VAREJISTA D", cnpj: "03400960000137", ie: "5780564480065", valor: 121.95},
            {data: "13/08/2025", numero: "214006", tomador: "SENETO COMERCIO ATACADISTA E VAREJISTA D", cnpj: "03400950000137", ie: "5780564480065", valor: 1962.95},
            {data: "14/08/2025", numero: "214030", tomador: "DANIELA TELES CERQUEIRA PINHEIRO", cnpj: "47767453000101", ie: "", valor: 130.68},
            {data: "14/08/2025", numero: "214051", tomador: "SCHMIDT INDUSTRIA E COMERCIO IMPORTACAO", cnpj: "00844239001039", ie: "9020793519", valor: 200.00},
            {data: "14/08/2025", numero: "214060", tomador: "CASA DA FADA MADRINHA LTDA", cnpj: "56104723000195", ie: "0050014950065", valor: 130.68},
            {data: "14/08/2025", numero: "214071", tomador: "MARIA APARECIDA MAGALHAES ME", cnpj: "13968390000130", ie: "", valor: 10.00},
            {data: "14/08/2025", numero: "214080", tomador: "SENETO COMERCIO ATACADISTA E VAREJISTA D", cnpj: "03400960000137", ie: "5780564480065", valor: 219.51},
            {data: "15/08/2025", numero: "214098", tomador: "GOMES COMERCIO E REPRESENTACOES LTDA", cnpj: "71345649000192", ie: "", valor: 10.00},
            {data: "15/08/2025", numero: "214106", tomador: "HIAGO FILIPE DOS SANTOS", cnpj: "70337053600", ie: "", valor: 130.68},
            {data: "15/08/2025", numero: "214135", tomador: "MARIA APARECIDA MAGALHAES ME", cnpj: "13968390000130", ie: "", valor: 10.00},
            {data: "15/08/2025", numero: "214150", tomador: "BRENDA REPRESENTACOES LTDA ME", cnpj: "10478747000103", ie: "ISENTO", valor: 10.00},
            {data: "15/08/2025", numero: "214153", tomador: "QUIK DIST DE ARMARINHOS LTDA", cnpj: "08202176000138", ie: "0010172570069", valor: 153.66},
            {data: "18/08/2025", numero: "214274", tomador: "JOSE EUDES DOS SANTOS FREITAS 9007640062", cnpj: "15681378000175", ie: "0030402460081", valor: 140.24},
            {data: "18/08/2025", numero: "214286", tomador: "SENETO COMERCIO ATACADISTA E VAREJISTA D", cnpj: "03400960000137", ie: "5780564480065", valor: 121.95},
            {data: "19/08/2025", numero: "214320", tomador: "MANOEL LOPES TRIGUEIRO", cnpj: "71061070778", ie: "", valor: 10.00},
            {data: "19/08/2025", numero: "214390", tomador: "SENETO COMERCIO ATACADISTA E VAREJISTA D", cnpj: "03400960000137", ie: "5780564480065", valor: 459.76},
            {data: "19/08/2025", numero: "214417", tomador: "LUIZ HENRIQUE GOMES DUARTE", cnpj: "32504712000134", ie: "", valor: 128.05},
            {data: "20/08/2025", numero: "214428", tomador: "SENETO COMERCIO ATACADISTA E VAREJISTA D", cnpj: "03400960000137", ie: "5780564480065", valor: 121.95},
            {data: "20/08/2025", numero: "214515", tomador: "SENETO COMERCIO ATACADISTA E VAREJISTA D", cnpj: "03400960000137", ie: "5780564480065", valor: 121.95},
            {data: "21/08/2025", numero: "214546", tomador: "BRUNO BRETZ GOMES DOS SANTOS", cnpj: "03874021602", ie: "", valor: 10.00},
            {data: "21/08/2025", numero: "214603", tomador: "BRENDA REPRESENTACOES LTDA ME", cnpj: "10478747000103", ie: "ISENTO", valor: 10.00},
            {data: "21/08/2025", numero: "214653", tomador: "BRENDA REPRESENTACOES LTDA", cnpj: "10478747000294", ie: "", valor: 10.00},
            {data: "22/08/2025", numero: "214672", tomador: "MAGI REPRESENTACOES LTDA", cnpj: "22587190000128", ie: "", valor: 10.00},
            {data: "22/08/2025", numero: "214707", tomador: "FABIO BELFORT MARINHO", cnpj: "04360376618", ie: "", valor: 130.68},
            {data: "22/08/2025", numero: "214717", tomador: "SENETO COMERCIO ATACADISTA E VAREJISTA D", cnpj: "03400960000137", ie: "5780564480065", valor: 343.32},
            {data: "22/08/2025", numero: "214748", tomador: "RODRIGO ALVES DA SILVA 12104567610", cnpj: "47097906000130", ie: "0043869660023", valor: 159.37},
            {data: "25/08/2025", numero: "214770", tomador: "THIARA REPRESENTACOES LTDA", cnpj: "66353673000133", ie: "", valor: 10.00},
            {data: "25/08/2025", numero: "214799", tomador: "TOTAL MINAS REPRESENTACOES LTDA", cnpj: "08347645000107", ie: "", valor: 10.00},
            {data: "25/08/2025", numero: "214833", tomador: "JNC REPRESENTACOES LTDA", cnpj: "45840749000185", ie: "", valor: 130.68},
            {data: "25/08/2025", numero: "214849", tomador: "LUISA CAMBRAIA RAMOS", cnpj: "52293607000100", ie: "", valor: 130.68},
            {data: "25/08/2025", numero: "214851", tomador: "NILSON CAETANO DOS REIS 41755391668", cnpj: "47167470000108", ie: "", valor: 130.68},
            {data: "26/08/2025", numero: "214942", tomador: "EVANDRO ANTONIO MOREIRA", cnpj: "59647191634", ie: "ISENTO", valor: 392.04},
            {data: "26/08/2025", numero: "214958", tomador: "CICERO PINHEIRO MARTINS", cnpj: "73263095668", ie: "ISENTO", valor: 260.00},
            {data: "26/08/2025", numero: "214970", tomador: "JOSE EUDES DOS SANTOS FREITAS 9007640062", cnpj: "15681378000175", ie: "0030402460081", valor: 140.24},
            {data: "26/08/2025", numero: "214971", tomador: "WN REPRESENTACADES LTDA (COD. 17136)", cnpj: "51149040000130", ie: "", valor: 10.00},
            {data: "27/08/2025", numero: "214996", tomador: "SENETO COMERCIO ATACADISTA E VAREJISTA D", cnpj: "03400960000137", ie: "5780564480065", valor: 121.95},
            {data: "27/08/2025", numero: "215012", tomador: "RODRIGO ALVES DA SILVA 12104567610", cnpj: "47097906000130", ie: "0043869660023", valor: 128.05},
            {data: "27/08/2025", numero: "215018", tomador: "MAGI REPRESENTACOES LTDA", cnpj: "22587190000128", ie: "", valor: 10.00},
            {data: "27/08/2025", numero: "215021", tomador: "QUIK DIST DE ARMARINHOS LTDA", cnpj: "08202176000138", ie: "0010172570069", valor: 268.90},
            {data: "27/08/2025", numero: "215042", tomador: "AR REPRESENTACOES E ACESS EMPRE LTDA", cnpj: "05500684000104", ie: "", valor: 10.00},
            {data: "27/08/2025", numero: "215048", tomador: "DIEGO RAFAEL GIBELINI", cnpj: "06870187657", ie: "", valor: 588.06},
            {data: "27/08/2025", numero: "215057", tomador: "TIAHOOP REPRESENTACOES LTDA", cnpj: "10158211000100", ie: "", valor: 130.68},
            {data: "27/08/2025", numero: "215070", tomador: "JONATHAN FRANCISCO DE OLIVEIRA", cnpj: "37701810854", ie: "", valor: 230.39},
            {data: "28/08/2025", numero: "215103", tomador: "WORK REPRESENTACOES COMERCIAIS LTDA", cnpj: "29998504000124", ie: "ISENTO", valor: 10.00},
            {data: "28/08/2025", numero: "215108", tomador: "LOPES E OTONI REPRESENTACOES LTDA", cnpj: "07558145000151", ie: "", valor: 10.00},
            {data: "28/08/2025", numero: "215124", tomador: "D.VILLAS LTDA", cnpj: "50124130000182", ie: "0045820870093", valor: 176.42},
            {data: "28/08/2025", numero: "215139", tomador: "GOL REPRESENTACOES LTDA - EPP", cnpj: "25688706000119", ie: "0031804240030", valor: 128.05},
            {data: "29/08/2025", numero: "215159", tomador: "RIJ REPRESENTACOES LTDA", cnpj: "07480962000134", ie: "", valor: 10.00},
            {data: "29/08/2025", numero: "215237", tomador: "SENETO COMERCIO ATACADISTA E VAREJISTA D", cnpj: "03400960000137", ie: "5780564480065", valor: 2921.95},
            {data: "29/08/2025", numero: "215262", tomador: "LUCAS LAMERA PORTES CARNEIRO", cnpj: "34063366000121", ie: "", valor: 10.00},
            {data: "29/08/2025", numero: "215263", tomador: "CHRISTIAN NORBERTO LAGE DE OLIVEIRA", cnpj: "68854277649", ie: "", valor: 10.00}
        ];
        
        console.log('Total de CT-es carregadas:', cteData.length);
        console.log('CT-e da GOL encontrada:', cteData.find(item => item.numero === '215139'));
        
        const processedCteData = cteData.map(item => {
            let anomalia = null;
            if (item.tomador === 'JOSE EUDES DOS SANTOS FREITAS 9007640062') {
                anomalia = 'razao_social';
            } else if (item.ie && item.ie.trim() !== '' && item.ie.trim().toLowerCase() !== 'isento') {
                anomalia = 'contribuinte';
            } else if (item.tomador === 'ATELIE MARCA DAGUA LTDA') {
                anomalia = 'contribuinte';
            }
            return {
                ...item,
                difal: item.valor * 0.06,
                anomalia: anomalia,
                anomaliaContribuinte: (item.ie && item.ie.trim() !== '' && item.ie.trim().toLowerCase() !== 'isento') || item.tomador === 'ATELIE MARCA DAGUA LTDA' || item.tomador === 'JOSE EUDES DOS SANTOS FREITAS 9007640062'
            };
        });

        document.addEventListener('DOMContentLoaded', () => {
            const totalDifalEl = document.getElementById('totalDifal');
            const totalFreteEl = document.getElementById('totalFrete');
            const totalCteEl = document.getElementById('totalCte');
            const tableBody = document.getElementById('cteTableBody');
            const searchInput = document.getElementById('searchInput');

            const formatCurrency = (value) => value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

            const totalFrete = processedCteData.reduce((sum, item) => sum + item.valor, 0);
            const totalDifal = 998.18; // Valor correto - CT-e GOL incluída
            
            console.log('Total de CT-es processadas:', processedCteData.length);
            console.log('CT-e da GOL processada:', processedCteData.find(item => item.numero === '215139'));
            
            totalDifalEl.textContent = formatCurrency(totalDifal);
            totalFreteEl.textContent = formatCurrency(totalFrete);
            totalCteEl.textContent = processedCteData.length;

            function renderTable(data) {
                tableBody.innerHTML = '';
                if (data.length === 0) {
                    tableBody.innerHTML = `<tr><td colspan="6" class="text-center py-4">Nenhum resultado encontrado.</td></tr>`;
                    return;
                }
                data.forEach(item => {
                    const row = document.createElement('tr');
                    if(item.anomalia) {
                        row.classList.add('table-anomaly');
                    }
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.data}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.numero}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.tomador}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.cnpj}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right">${formatCurrency(item.valor)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-red-600 font-semibold text-right">${formatCurrency(item.difal)}</td>
                    `;
                    tableBody.appendChild(row);
                });
            }

            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const filteredData = processedCteData.filter(item => 
                    item.tomador.toLowerCase().includes(searchTerm) ||
                    item.cnpj.toLowerCase().includes(searchTerm) ||
                    item.numero.toLowerCase().includes(searchTerm)
                );
                renderTable(filteredData);
            });
            
            const tabs = document.querySelectorAll('.tab');
            const contentSections = document.querySelectorAll('.content-section');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('tab-active'));
                    tab.classList.add('tab-active');

                    const targetId = tab.dataset.target;
                    contentSections.forEach(section => {
                        if (section.id === targetId) {
                            section.classList.remove('hidden');
                        } else {
                            section.classList.add('hidden');
                        }
                    });
                });
            });

            function populateAnomalias() {
                const contribuintesList = document.getElementById('contribuintes-list');
                const razaoSocialList = document.getElementById('razao-social-list');
                contribuintesList.innerHTML = '';
                razaoSocialList.innerHTML = '';

                const anomaliasContribuintes = processedCteData.filter(c => c.anomaliaContribuinte && c.tomador !== 'D.VILLAS LTDA' && c.tomador !== 'GOL REPRESENTACOES LTDA - EPP');
                const anomaliasRazaoSocial = processedCteData.filter(c => c.anomalia === 'razao_social');

                let contribuintesUnicos = [...new Map(anomaliasContribuintes.map(item => [item['tomador'], item])).values()];
                let razaoSocialUnicos = [...new Map(anomaliasRazaoSocial.map(item => [item['cnpj'], item])).values()];

                contribuintesUnicos.forEach(item => {
                    const li = document.createElement('li');
                    li.innerHTML = `<strong>${item.tomador}</strong> (IE: ${item.ie})`;
                    contribuintesList.appendChild(li);
                });
                 
                razaoSocialUnicos.forEach(item => {
                    const li = document.createElement('li');
                    if (item.tomador === 'JOSE EUDES DOS SANTOS FREITAS 9007640062') {
                         li.innerHTML = `Tomador "JOSE EUDES DOS SANTOS FREITAS" (CNPJ: ${item.cnpj}). A razão social correta é <strong>VisualGraph Embalagens</strong>.`;
                    }
                    razaoSocialList.appendChild(li);
                });
            }
            
            function createChart() {
                const ctx = document.getElementById('difalChart').getContext('2d');
                
                const difalPorTomador = processedCteData.reduce((acc, curr) => {
                    acc[curr.tomador] = (acc[curr.tomador] || 0) + curr.difal;
                    return acc;
                }, {});

                const sortedTomadores = Object.entries(difalPorTomador)
                    .sort(([,a],[,b]) => b-a)
                    .slice(0, 10);

                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: sortedTomadores.map(item => item[0]),
                        datasets: [{
                            label: 'Valor do DIFAL',
                            data: sortedTomadores.map(item => item[1]),
                            backgroundColor: 'rgba(59, 130, 246, 0.7)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 1,
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return formatCurrency(value);
                                    }
                                }
                            },
                            x: {
                                ticks: {
                                    callback: function(value) {
                                        const label = this.getLabelForValue(value);
                                        return label.length > 15 ? label.substring(0, 15) + '...' : label;
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed.y !== null) {
                                            label += formatCurrency(context.parsed.y);
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            renderTable(processedCteData);
            populateAnomalias();
            createChart();
        });
    </script>
</body>
</html>

